# Command-line Interface

`milone` command is the standard CLI for milone-lang projects.

## Subcommands

- [run](#run)
- [build](#build)
- [eval](#eval)

Less important:

- [check](#check)
- [compile](#compile)
- [help](#help)
- [version](#version)

### `run`

Run a project.

```sh
milone run <PROJECT-DIR> [-- ARGS...]
```

Examples:

```sh
milone run ./MiloneProject
```

```sh
milone run ./MiloneProject -- --flag arg1 arg2
```

Requirements:

- On linux:
    [GCC](#require-gcc),
    [ninja](#require-ninja-build)
- On windows:
    [MSBuild](#require-msbuild)

Options:

- `-- ARGS...`
    - Arguments for generated executable.
    - Note that `--` is required to pass some args.
- `--release`
    - Compile in release mode.
- `--target-dir <DIR>` (defaults to `target/<PROJECT-NAME>`)
    - Specify target directory.
    - That directory contains intermediate files and output files.
    - Note that `<PROJECT-NAME>` is basename of project directory.

Output:

- Code:
    - 1 if compile failed.
    - Exit code that executed program returned.
- Stdout: Inherited to executed program.
- Stderr: Compile progress and compile errors. Inherited to executed program too.
- Files: Same as [build](#build)

### `build`

Build a project for an executable.

```sh
milone build <PROJECT-DIR>
```

Examples:

```sh
milone build ./MiloneProject
```

```sh
milone build ./MiloneProject --release --target-dir ../build
```

Options:

- `--release`
    - Compile in release mode.
- `--target-dir <DIR>` (defaults to `target/<PROJECT-NAME>`)
    - Specify target directory.
    - That directory contains intermediate files and output files.
    - Note that `<PROJECT-NAME>` is basename of project directory.
- `--output <FILE>`, `-o <FILE>`
    - Copy the output file to specified destination after successful build.

Output:

- Code: 0 if success. 1 if error.
- Stdout: Compilation progress and compile errors.
- Files:
    - `<TARGET-DIR>/*.c`: C files (if success)
    - `<TARGET-DIR>/<PROJECT-NAME>.exe`: Executable (if success)
    - where `TARGET-DIR` is specified by `--target-dir` option
    - `<FILE>` specified by `-o`/`--output` (if success)
    - On linux:
        - `<TARGET-DIR>/build.ninja`
    - On windows:
        - `<TARGET-DIR>/<PROJECT-NAME>.sln`
        - `<TARGET-DIR>/<PROJECT-NAME>/<PROJECT-NAME>.vcxproj`
        - `<TARGET-DIR>/<PROJECT-NAME>/target/**` (generated by MSBuild)

### `eval`

Compute an expression.

```sh
milone eval <EXPRESSION>
```

Examples:

```sh
milone eval '40 + 2'
#=> 42
```

```sh
milone eval '
let rec fact n =
  if n <= 1 then 1 else n * fact (n - 1)
fact 5'
#=> 120
```

Options: None.

Output:

- Code: 0 if success. 1 if error.
- Stdout: Evaluation result.
- Files:
    - `target/Eval/**`: Intermediate files.

Remarks:

- Expression must be of a type that can convert to `string`.
- Line numbers in compile error are incorrect.
- `milone eval -` reads an expression from standard input that ends with an EOF character.

### `check`

Check if a project is *valid*.

```sh
milone check <PROJECT-DIR>
```

Examples:

```sh
milone check ./MiloneProject
```

Description:

- Valid means:
    - *well-formed* (parsing is okay), and
    - *well-typed* (type checking is okay).
- Report compile errors.
- Unlike `build` subcommand, code generation is skipped for faster feedback.

Output:

- Code: 0 if okay.
- Stdout: Compile errors if any.

### `compile`

Compile a project to C source files.

Examples:

```sh
milone compile <PROJECT-DIR>
```

```sh
milone compile ./MiloneProject
```

Output:

- Code: 0 if success. 1 if error.
- Stdout: Compilation progress and compile errors.
- Files:
    - `<TARGET-DIR>/*.c`: C files (if success)

### `help`

Print help text of the milone command.

```sh
milone help
```

Equivalent:

```sh
milone
milone -h
milone --help
```

Output:

- Code: 0.
- Stdout: Help text.

### `version`

Print version number of the milone command.

```sh
milone version
```

Equivalent:

```sh
milone -V
milone --version
```

Output:

- Code: 0.
- Stdout: `0.0.0\n` for example.

----

## Global Options

These options works in any subcommands. Currently you want none of them.

```
    -v, --verbose   Enable verbose logging for debug
        --profile   Enable profile logging
    -q, --quiet     Disable logging (default)
        --parallel  Enable parallel compilation (experimental)
```

----

## Requirements

Some of subcommands require something on runtime environment.

### require-GCC

(On linux only.)

Install GCC 7.5.0.

Notes:

- Installation process varies.
    - I did `sudo apt install build-essential` on Ubuntu.
- `clang` is also okay. Set `CC` environment variable to `clang`.

### require-ninja-build

(On linux only.)

Install [ninja-build 1.10.2](https://github.com/ninja-build/ninja).

Notes:

- `ninja` command (also known as `ninja-build`) is a build tool.
- It runs subprocesses and provides some profits. Ninja does:
    - print progress messages nicely
    - run subprocesses in parallel
    - skip unnecessary jobs

### require-MSBuild

(On windows only.)

Install [Visual Studio 2022 Build Tools](https://visualstudio.microsoft.com/ja/downloads/?q=build+tools#build-tools-for-visual-studio-2022).

Notes:

- `MSBuild.exe` is a build tool that is used to compile C (MSVC) project on windows.

----

## Less Important Features

- `--project <PROJECT-DIR>`
    - Subcommands that take `<PROJECT-DIR>` as positional argument also support `--project` option instead.
    - That's to match behavior with `dotnet run`.
- `--release` and `--target-dir`
    - `check` and `compile` subcommands accept these flags but ignore. (So that you can replace `build` subcommand with `check` without changing other args.)
- `--debug` (inversion of `--release`) is accepted but ignored.

## Misc Notes

- I'm NOT familiar with external tools; please teach me.
- Interface is similar to `cargo` (in Rust).
- On linux: consider to install [mold](https://github.com/rui314/mold) for faster linking.
