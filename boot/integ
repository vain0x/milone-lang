#!/bin/bash
# Perform integration tests.

set -eu

try () {
    app="./tmp/$1"
    out="./tmp/$1.out"
    exp="./tests/targets/$1.out"
    ./trans "$1"

    set +e
    $app >$out
    echo '$? = '$? >>$out
    diff -q $out $exp || {
        >&2 echo "FAILED $1"
    }
    set -e
}

try "zero"
try "add"
try "arith"
try "hello"
try "var_1"
try "var_str"
try "shadowing"
try "if_else"
try "if_else_complex"

echo "OK" >&2
