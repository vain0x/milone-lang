ScopeCtx:
  # Last serial number.
  # We need manage identifiers as integers rather than strings due to shadowing.
  Serial: Serial

  # Serial to ident map.
  NameMap: AssocMap<Serial, Ident>

  # Variable serial to definition map.
  Vars: AssocMap<VarSerial, VarDef>

  # Variable serial to let-depth map.
  VarDepths: AssocMap<VarSerial, LetDepth>

  # Type serial to definition map.
  Tys: AssocMap<TySerial, TyDef>

  # Type serial to let-depth map.
  TyDepths: AssocMap<TySerial, LetDepth>

  # Namespace tree of vars.
  VarNs: NameTree

  TyNs: NameTree

  # Serial of the current scope.
  LocalSerial: ScopeSerial

  # Current scope.
  Local: Scope

  # Current let-depth, the number of ancestral let-body.
  LetDepth: LetDepth

TyContext:
  Serial: Serial
  Tys: AssocMap<TySerial, TyDef>
  TyDepths: AssocMap<TySerial, LetDepth>

TyCtx:
  # Next serial number.
  # We need to identify variables by serial number rather than names
  # due to scope locality and shadowing.
  Serial: Serial

  # Variable serial to variable definition.
  Vars: AssocMap<VarSerial, VarDef>

  # Type serial to type definition.
  Tys: AssocMap<TySerial, TyDef>

  TyDepths: AssocMap<TySerial, LetDepth>
  LetDepth: LetDepth
  TraitBounds: (Trait * Loc) list
  Logs: (Log * Loc) list

TyElaborationCtx:
  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>
  RecordMap: AssocMap<TySerial, Ty * AssocMap<Ident, int * Ty>>

KnownCtx:
  Known: AssocSet<FunSerial>
  Locals: AssocSet<VarSerial>
  Refs: AssocSet<VarSerial>

CcCtx:
  Serial: Serial
  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>
  Current: KnownCtx
  Funs: AssocMap<FunSerial, KnownCtx>

EtaCtx:
  Serial: Serial
  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>

MonoCtx:
  Serial: Serial
  Logs: (Log * Loc) list

  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>
  TyDepths: AssocMap<TySerial, LetDepth>

  # Map from
  # - generic function serial
  #
  # to:
  # - found use-site types
  GenericFunUseSiteTys: AssocMap<FunSerial, Ty list>

  # Map from pairs:
  # - generic function's serial
  # - monomorphic type
  #
  # to:
  # - monomorphized function's serial
  GenericFunMonoSerials: AssocMap<FunSerial * Ty, FunSerial>

  Mode: MonoMode
  SomethingHappened: bool
  InfiniteLoopDetector: int

KirGenCtx:
  Serial: Serial
  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>
  Logs: (Log * Loc) list
  MainFunSerial: FunSerial option
  Joints: KJointBinding list
  Funs: KFunBinding list

KirPropagateCtx:
  VarDefs: AssocMap<VarSerial, KVarDef>
  VarUses: AssocMap<VarSerial, int>

KirToMirCtx:
  Serial: Serial
  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>
  MainFunSerial: FunSerial option
  LabelSerial: Serial
  JointMap: AssocMap<JointSerial, Label * VarSerial list>
  Labels: MStmt list list
  LabelCount: int
  Stmts: MStmt list
  Logs: (Log * Loc) list

MirCtx:
  Serial: Serial
  Vars: AssocMap<VarSerial, VarDef>
  Tys: AssocMap<TySerial, TyDef>
  LabelSerial: Serial
  Stmts: MStmt list
  Logs: (Log * Loc) list

CirCtx:
  Vars: AssocMap<VarSerial, VarDef>
  VarUniqueNames: AssocMap<VarSerial, Ident>
  TyEnv: AssocMap<Ty, CTyInstance * CTy>
  Tys: AssocMap<TySerial, TyDef>
  TyUniqueNames: AssocMap<Ty, Ident>
  Stmts: CStmt list
  Decls: CDecl list
  Logs: (Log * Loc) list

# Abstraction layer of CLI program.
CliHost:
  # Command line args.
  Args: string list

  # Creates a profiler.
  ProfileInit: (unit -> Profiler)

  # Prints a message to stderr for profiling.
  ProfileLog: (string -> Profiler -> unit)

  # Reads all contents of a file as string.
  FileReadAllText: (string -> string option)
